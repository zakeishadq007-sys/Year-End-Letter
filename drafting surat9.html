
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>End Year Letter + Fireworks</title>

  <style>
    :root{
      --bg1:#0b0f1a; --bg2:#1a1f2e; 
      --envelope:#ffe8de; --flap:#562a19; --paper:#f3ede7;
      --envelope-shadow:#d0a899; --accent:#DFD0B9; 
      --paper-shadow:#e3d2bc; --ink:#550615;
    }
    *{ box-sizing:border-box; }

    /* Latar malam + tata huruf */
    body{
      margin:0; padding:0; min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      background: radial-gradient(ellipse at bottom, var(--bg2), var(--bg1));
      font-family:'Times New Roman', Times, serif;
      font-style:italic; color:#fff;
      overflow-x:hidden;
    }

    /* === CANVAS FIREWORKS di belakang === */
    #fireworks{
      position:fixed; inset:0;
      width:100vw; height:100vh; display:block;
      pointer-events:none;        /* tidak menghalangi klik */
      z-index:0;                  /* di belakang konten */
      filter:contrast(110%) saturate(120%);
    }

    /* Kontainer amplop */
    .scene{
      width:clamp(300px, 90vw, 560px);
      aspect-ratio:1/1;
      position:relative;
      filter:drop-shadow(0 18px 40px rgba(0,0,0,.5));
      cursor:pointer; margin:20px auto;
      z-index:1;                 /* di atas canvas */
    }

    .envelope{
      position:absolute; inset:120px 40px 120px 40px;
      border-radius:10px;
      background:linear-gradient(180deg, var(--envelope) 0%, #e3b9a7 40%, var(--envelope) 100%);
      overflow:visible;
    }
    .envelope::before{
      content:"";
      position:absolute; inset:auto 0 0 0; height:54%;
      background:
        linear-gradient(135deg, transparent 48%, var(--envelope-shadow) 48.2%) left/50% 100% no-repeat,
        linear-gradient(225deg, transparent 48%, var(--envelope-shadow) 48.2%) right/50% 100% no-repeat;
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      transform-origin:center bottom;
    }

    .flap{
      position:absolute; left:0; right:0; top:0; height:55%;
      background:linear-gradient(180deg, var(--flap) 0%, #9a573d 100%);
      clip-path:polygon(0 0, 100% 0, 50% 100%);
      transform-origin:50% 0%;
      transition:transform .3s cubic-bezier(.2,.8,.2,1);
      z-index:10;
      transform:rotateX(90deg); /* default terbuka (akan diubah oleh .close) */
    }

    .stamp{
      position:absolute; left:38%; top:35%;
      width:120px; height:120px; border-radius:100%;
      overflow:hidden; display:flex; align-items:center; justify-content:center;
      z-index:100; transition:all .6s ease; transform:rotate(0deg);
    }
    .stamp img{ width:120px; height:120px; object-fit:cover; display:block; }
    .stamp::before{
      content:""; position:absolute; inset:0; border-radius:50%;
      box-shadow:0 0 12px rgba(0,0,0,.2); pointer-events:none;
    }

    .paper{
      position:absolute; left:10%; right:10%; bottom:12%; height:64%;
      background:var(--paper);
      border-radius:8px;
      box-shadow:0 6px 16px rgba(0,0,0,.25), inset 0 -10px 30px var(--paper-shadow);
      z-index:2; padding:clamp(14px, 4vw, 24px); color:var(--ink);
      transform:translateY(30%) scale(.98); opacity:0;
      transition:all .6s cubic-bezier(.2,.8,.2,1);
      overflow-y:auto; overflow-x:hidden;
    }
    .paper h3{ margin:0 0 8px; font-size:clamp(20px, 3.5vw, 22px); color:#d91b5c; }
    .paper hr{ border:none; height:1px; background:linear-gradient(to right, transparent, #d91b5c, transparent); margin:8px 0 12px; }
    .paper p{ font-size:clamp(14px, 3vw, 18px); line-height:2; margin:12px 0; text-align:justify; }

    /* Foto di dalam surat (lebih responsif) */
    .paper .photos{
      display:flex; flex-wrap:wrap; gap:10px;
      justify-content:center;
    }
    .paper .photos img{
      width:clamp(140px, 30%, 300px);
      max-width:100%; height:auto; border-radius:8px;
      box-shadow:0 4px 10px rgba(0,0,0,.15);
    }

    .hint{
      position:absolute; inset:auto 0 4% 0; text-align:center;
      font-size:clamp(12px, 2.8vw, 14px); color:#e6d7ff; opacity:.9;
      user-select:none; pointer-events:none; z-index:7; animation:pulse 2s infinite;
    }
    @keyframes pulse{ 0%,100%{opacity:.9} 50%{opacity:.5} }

    .controls{
      position:absolute; top:6%; right:8%;
      display:flex; gap:8px; z-index:8;
    }
    .btn{
      background:rgba(255,255,255,.18); color:#fff;
      border:1px solid rgba(255,255,255,.25);
      padding:6px 10px; border-radius:8px; font-size:12px;
      backdrop-filter:blur(4px); cursor:pointer; transition:all .3s ease;
    }
    .btn:hover{ background:rgba(255,255,255,.3); }
    .btn:active{ transform:translateY(2px); }

    /* State */
    .scene.open .flap{  transform:rotateX(90deg); }
    .scene.open .paper{ transform:translateY(-10%) scale(1); opacity:1; overflow:auto; }
    .scene.open .stamp{ transform:translateY(-120%) translateX(-50%) scale(.98); opacity:0; }
    .scene.close .flap{ transform:rotateX(0deg); }
    .scene.close .paper{ transform:translateY(50%) scale(.98); opacity:0; }

    /* Mobile */
    @media (max-width:600px){
      .paper{ padding:14px; top:16%; height:66%; }
      .controls{ top:4%; right:4%; gap:6px; }
      .btn{ padding:6px 10px; font-size:11px; }
    }
  </style>
</head>
<body>

  <!-- Fireworks background -->
  <canvas id="fireworks"></canvas>

  <!-- Amplop interaktif -->
  <div class="scene close" id="scene" role="button" tabindex="0" aria-label="Ketuk untuk membuka atau menutup amplop">
    <div class="envelope">
      <div class="flap"></div>

      <div class="stamp">
        stamp.png
      </div>

      <div class="paper">
        <h3>Halooo nicholaassssapuutraaaa!!</h3>
        <hr />
        <p>Well, first.. I hope this so-called letter running well at you.
        I know this is kinda weird, writing a letter in 2025, but hey, why not?
        I just want to say thank you for being such an amazing friend throughout this year.</p>

        <p>Our red string begins when I borrowed you my umbrella to handle panasnya PKKMB.. and I never thought we've been these far.
        You showing what's your true colors, being there when I need someone to talk to, and just being you.
        I really appreciate our friendship, and I hope we can keep this bond strong in the years to come.
        Wishing you all the best for the new year ahead! May it be filled with joy, success, and lots of memorable moments.</p>

        <p>Untuk aku yang masih sering bingung apasih yang mau aku lakuin, thank you for realizing me, that it's okay to not have everything figured out yet.
        Makasih udh mau "baca" aku, dengerin curhatanku yang kadang suka random, dan ngasih aku perspektif baru.
        Actually, there are still a lot of your questions that I haven't answered yet, but I promise I'll get to them when I'm ready.
        So, here's to another year of friendship, laughter, and unforgettable memories.
        Semoga kita kedepannya masih bisa bareng dengan segala ups and downsnya.
        Yeah, that's all I can say and let me keep the rest in my du'a.</p>

        <p style="text-align:right;">Sincerely,<br />@zakeishadq</p>
        <hr />
        <p style="text-align:center;">new cute fotbar section hehe</p>

        <div class="photos">
          nc1.png
          nc2.png
          nc3.png
        </div>
      </div>
    </div>

    <div class="hint">Ketuk untuk BUKA â€” ketuk lagi untuk TUTUP</div>

    <div class="controls" aria-label="Kontrol">
      <button class="btn" id="btnMute">ðŸ”Š Suara</button>
      <button class="btn" id="burst">ðŸŽ† Pecahkan</button>
    </div>
  </div>

  <!-- Audio -->
  <audio id="music" loop>
    Olivia Dean - A Couple Minutes.mp3
  </audio>

  <!-- ==== SCRIPT: Envelope + Fireworks ==== -->
  <script>
    /* ====== Amplop & Audio ====== */
    const scene   = document.getElementById('scene');
    const music   = document.getElementById('music');
    const btnMute = document.getElementById('btnMute');
    const btnBurst= document.getElementById('burst');

    music.volume = 0.6;
    let isOpen = false;

    function playMusicSafe(){
      music.play().catch(err => {
        console.warn('Tidak bisa memutar audio sekarang:', err);
      });
    }
    function pauseMusic(){ music.pause(); }

    function toggleEnvelope(e){
      e.stopPropagation();
      if (isOpen){
        scene.classList.remove('open');
        scene.classList.add('close');
        pauseMusic();
        isOpen = false;
      }else{
        scene.classList.remove('close');
        scene.classList.add('open');
        playMusicSafe();
        isOpen = true;
      }
    }

    scene.addEventListener('click', toggleEnvelope);
    scene.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleEnvelope(e);
      }
    });

    btnMute.addEventListener('click', (e) => {
      e.stopPropagation();
      music.muted = !music.muted;
      btnMute.textContent = music.muted ? 'ðŸ”‡ Mute' : 'ðŸ”Š Suara';
    });

    music.load();

    /* ====== Fireworks (Canvas) ====== */
    const canvas = document.getElementById('fireworks');
    const ctx = canvas.getContext('2d');

    // DPI-aware resize
    const resize = () => {
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      canvas.width  = Math.floor(innerWidth  * dpr);
      canvas.height = Math.floor(innerHeight * dpr);
      canvas.style.width  = innerWidth + 'px';
      canvas.style.height = innerHeight + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    };
    window.addEventListener('resize', resize, { passive:true });
    resize();

    const rand = (min, max) => Math.random() * (max - min) + min;
    const colors = ['#ffb703','#fb5607','#ff006e','#8338ec','#3a86ff','#00f5d4','#ffd166'];

    class Particle{
      constructor(x, y, color, speed, angle){
        this.x=x; this.y=y;
        this.vx=Math.cos(angle)*speed;
        this.vy=Math.sin(angle)*speed;
        this.alpha=1; this.size=rand(1,2.6);
        this.color=color; this.gravity=0.05; this.friction=0.992;
        this.twinkle=Math.random()<0.25;
        this.life=rand(50,120); this.age=0;
      }
      update(){
        this.age++;
        this.vx*=this.friction; this.vy*=this.friction; this.vy+=this.gravity;
        this.x+=this.vx; this.y+=this.vy;
        this.alpha=Math.max(0, 1 - (this.age/this.life));
      }
      draw(ctx){
        if (this.twinkle && Math.random()<0.05) return;
        ctx.globalAlpha=this.alpha;
        ctx.fillStyle=this.color;
        ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
        ctx.fill(); ctx.globalAlpha=1;
      }
      get dead(){ return this.alpha<=0.02; }
    }

    class Rocket{
      constructor(x, targetY, color){
        this.x=x; this.y=innerHeight+rand(20,80);
        this.vx=rand(-0.8,0.8); this.vy=rand(-9,-12);
        this.targetY=targetY; this.color=color;
        this.trail=[]; this.exploded=false;
      }
      update(){
        if (this.exploded) return;
        this.x+=this.vx; this.y+=this.vy; this.vy+=0.08;
        this.trail.push({x:this.x,y:this.y}); if (this.trail.length>10) this.trail.shift();
        if (this.y<=this.targetY || this.vy>=-0.5){
          this.exploded=true; explode(this.x, this.y, this.color);
        }
      }
      draw(ctx){
        if (this.exploded) return;
        ctx.fillStyle='#fff'; ctx.globalAlpha=0.9;
        ctx.beginPath(); ctx.arc(this.x, this.y, 2.2, 0, Math.PI*2); ctx.fill(); ctx.globalAlpha=1;
        for (let i=0;i<this.trail.length-1;i++){
          const a=this.trail[i], b=this.trail[i+1];
          ctx.strokeStyle=this.color; ctx.globalAlpha=i/this.trail.length; ctx.lineWidth=2;
          ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); ctx.globalAlpha=1;
        }
      }
    }

    const particles=[]; const rockets=[];

    function explode(x,y,baseColor){
      const shards=Math.floor(rand(40,85));
      for(let i=0;i<shards;i++){
        const angle=rand(0,Math.PI*2); const speed=rand(2.2,6.8);
        const color=Math.random()<0.2 ? '#ffffff' : baseColor;
        particles.push(new Particle(x,y,color,speed,angle));
      }
      if (Math.random()<0.35){
        const ringColor = colors[(Math.random()*colors.length)|0];
        for(let i=0;i<40;i++){
          const angle=(i/40)*Math.PI*2;
          particles.push(new Particle(x,y,ringColor,4.5,angle));
        }
      }
    }

    let last=0;
    function tick(ts){
      last=ts;
      ctx.fillStyle='rgba(10,13,24,0.25)';
      ctx.fillRect(0,0,innerWidth,innerHeight);

      if (Math.random()<0.03){
        rockets.push(new Rocket(
          rand(innerWidth*0.1, innerWidth*0.9),
          rand(innerHeight*0.18, innerHeight*0.45),
          colors[(Math.random()*colors.length)|0]
        ));
      }

      for (let i=rockets.length-1;i>=0;i--){
        const r=rockets[i]; r.update(); r.draw(ctx);
        if (r.exploded) rockets.splice(i,1);
      }
      for (let i=particles.length-1;i>=0;i--){
        const p=particles[i]; p.update(); p.draw(ctx);
        if (p.dead) particles.splice(i,1);
      }
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    // klik di mana saja â†’ ledakan; tombol â†’ ledak di tengah amplop
    window.addEventListener('pointerdown',(e)=> explode(e.clientX, e.clientY, colors[(Math.random()*colors.length)|0]));
    btnBurst.addEventListener('click', (e) => {
      e.stopPropagation();
      const rect = scene.getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top  + rect.height*0.35;
      explode(cx, cy, colors[(Math.random()*colors.length)|0]);
    });
  </script>
</body>
</html>